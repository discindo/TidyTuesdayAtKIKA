---
title: '#TidyTuesday 3 / 17.9.2019: Week 38 US National Parks'
author: "novica"
date: "17/9/2019"
output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      warning = FALSE, message = FALSE)
```

## _Post hoc_ synopsis

–û–≤–∞–∞ –Ω–µ–¥–µ–ª–∞ —Å–µ –ø–æ—Å–≤–µ—Ç–∏–≤–º–µ –ø–æ–≤–µ—ú–µ –∫–æ–Ω –Ω–∞—á–∏–Ω–æ—Ç –Ω–∞ –ø–∏—à—É–≤–∞—ö–µ `ggplot2` –∫–æ–¥, –∏–º–µ–Ω–æ, –¥–∞–ª–∏ —Å–∏—Ç–µ –µ—Å—Ç–µ—Ç–∏–∫–∏ —Å–µ –ø–æ–¥–µ—Å—É–≤–∞–∞—Ç —Å–æ –µ–¥–µ–Ω –ø–æ–≤–∏–∫ –¥–æ `aes` –∏–ª–∏ —Å–µ–∫–æ—ò–∞ –ø–æ—Å–µ–±–Ω–æ. –°–ª–∏—á–Ω–æ –ø—Ä–∞–∫—Å–∞ –º–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–∏–º–µ–Ω–∏ –∏ –∑–∞ –¥—Ä—É–≥–∏ `ggplot2` —Ñ—É–Ω—Ü–∫–∏–∏ –∫–æ–∏—à—Ç–æ –¥–æ–∫–æ–ª–∫—É –≥–∏ –ø–æ–≤–∏–∫–∞–º–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–µ —Å–µ –≤–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ –ø—Ä–µ—Ç—Ö–æ–¥–Ω–∏–æ—Ç –∫–æ–¥. –¢–∞–∫–≤–∏ —Å–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä `labs` –∏–ª–∏ `theme` (–ø—Ä–∏–º–µ—Ä–∏ –ø–æ–¥–æ–ª—É). –°–ª–∏—á–Ω–æ –º–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–∏–º–µ–Ω–∏ –∏ —Å–æ `dplyr::filter`, –∫–∞–¥–µ —à—Ç–æ —á–µ—Å—Ç–æ, –Ω–æ –Ω–µ —Å–µ–∫–æ–≥–∞—à, –º–æ–∂–µ –¥–∞ —Ñ–∏–ª—Ç—Ä–∏—Ä–∞–º–µ –ø–æ–¥–∞—Ç–æ—Ü–∏ —Å–æ —Å–∏–Ω—Ç–∞–∫—Å–∞—Ç–∞ `filter(x="x", y="y")` –∏–ª–∏ `filter(x="a") %>% filter(y="b")`. –û–≤–∞ –µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –æ–¥ –∞—Å–ø–µ–∫—Ç –Ω–∞ —á–∏—Ç–ª–∏–≤–æ—Å—Ç–∞ –Ω–∞ –∫–æ–¥–æ—Ç –∏ –∏–∞–∫–æ –±–∞—Ä–∞ –ø–æ–≤–µ—ú–µ –ø–∏—à—É–≤–∞—ö–µ, –¥–æ–ª–≥–∞—Ç–∞ —Ñ–æ—Ä–º–∞ (—Å–æ –ø–æ—Å–µ–±–µ–Ω `aes` –∑–∞ —Å–µ–∫–æ—ò–∞ –µ—Å—Ç–µ—Ç–∏–∫–∞) –º–æ–∂–µ–±–∏ –µ –ø–æ–¥–æ—Å—Ç–∞–ø–Ω–∞ –∑–∞ –Ω–æ–≤–∏ –∫–æ—Ä–∏—Å–Ω–∏—Ü–∏. 

–î—Ä—É–≥–∏ –Ω–æ–≤–∏–Ω–∏ –≤–æ –æ–≤–æ—ò –¥–æ–∫—É–º–µ–Ω—Ç —Å–µ –æ–¥–Ω–µ—Å—É–≤–∞–∞—Ç –Ω–∞ —Å—Ç–∏–ª–∏–∑–∏—Ä–∞—ö–µ –Ω–∞ `ggplot2` –≥—Ä–∞—Ñ–∏—Ü–∏, —Å–æ –æ—Å–Ω–æ–≤–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –¥–æ–¥–∞—Ç–Ω–∏ –ø–∞–∫–µ—Ç–∏ (`ggridges`).

## –†–µ–∑–∏–º–µ

- `.Rmd` (`R Markdown`) –µ –æ–∫–æ–ª–∏–Ω–∞—Ç–∞ –≤–æ –∫–æ—ò–∞ —ú–µ —Ä–∞–±–æ—Ç–∏–º–µ
- –ù–æ–≤ `R Notebook`: –ú–µ–Ω–∏: `File -> New File -> R notebook`
- –ö–æ—Ä–∏—Å–Ω–∏ –∫—Ä–∞—Ç–µ–Ω–∫–∏:
  - code chunks (`ctrl+alt+i`)
  - pipes `%>%` (`ctrl+shift+m`)
  - assignment `<-` (`alt+-`)
  - `view()`

## Pipes expained, maybe

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">This is how I explain the &#39;pipe&#39; to <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> newbies... <a href="https://t.co/VdAFTLzijy">pic.twitter.com/VdAFTLzijy</a></p>&mdash; We are R-Ladies (@WeAreRLadies) <a href="https://twitter.com/WeAreRLadies/status/1172576445794803713?ref_src=twsrc%5Etfw">September 13, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

## –ù–æ–≤ dataset

TidyTuesday 38: –ø–æ–¥–∞—Ç–æ—Ü–∏ –æ–¥ –Ω–∞—Ü–∏–æ–Ω–∞–ª–Ω–∏—Ç–µ –ø–∞—Ä–∫–æ–≤–∏ –≤–æ –°–ê–î

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">The <a href="https://twitter.com/R4DScommunity?ref_src=twsrc%5Etfw">@R4DScommunity</a> welcomes you to week 38 of <a href="https://twitter.com/hashtag/TidyTuesday?src=hash&amp;ref_src=twsrc%5Etfw">#TidyTuesday</a>! We&#39;re exploring National Park Visits!!<br><br>üìÅ <a href="https://t.co/sElb4fcv3u">https://t.co/sElb4fcv3u</a><br>üóû <a href="https://t.co/uKMrTmKokT">https://t.co/uKMrTmKokT</a><a href="https://twitter.com/hashtag/r4ds?src=hash&amp;ref_src=twsrc%5Etfw">#r4ds</a> <a href="https://twitter.com/hashtag/tidyverse?src=hash&amp;ref_src=twsrc%5Etfw">#tidyverse</a> <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://twitter.com/hashtag/dataviz?src=hash&amp;ref_src=twsrc%5Etfw">#dataviz</a> <a href="https://t.co/92S7a7mzuj">pic.twitter.com/92S7a7mzuj</a></p>&mdash; Thomas Mock üë®üèº
üíª (@thomas_mock) <a href="https://twitter.com/thomas_mock/status/1173586589462740994?ref_src=twsrc%5Etfw">September 16, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


## –ë—Ä–∑ –∏ –±–∞–≤–µ–Ω ggplot

### –í–æ–æ–±–∏—á–∞–µ–Ω–æ:

```{r, eval = FALSE}
ggplot(my_data,
 aes(var1, y = var2, col = var3)) +
  geom_point() +
  ggtitle("My Title") +
  labs(x = "the x label",
   y = "the y label",
   col = "legend title")
```

(–∏–∑–≤–æ—Ä:[EvaMaeRey](https://github.com/EvaMaeRey/little_flipbooks_library/tree/master/minimal_example))

### –ë–∞–≤–Ω–æ:

```{r, eval = F}
ggplot(data = my_data) +
  aes(x = var1) +
  labs(x = "the x label") +
  aes(y = var2) +
  labs(y = "the y label") +
  geom_point() +
  aes(col = var3) +
  labs(col = "legend title") +
  labs(title = "My title")
```

## –Ö–∏—Ä–Ω–∏ –≥–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ —Å–æ glimpse

```{r}
library(tidyverse)
library(dplyr)

park_visits <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-17/national_parks.csv")

glimpse(park_visits)
```

## –í–∫—É–ø–µ–Ω –±—Ä–æ—ò –Ω–∞ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ –ø–æ –≥–æ–¥–∏–Ω–∏

```{r group_the_data_1}
pv_grouped <- park_visits %>%
  filter(unit_type == "National Park") %>%
  filter(!year == "Total") %>%
  group_by(year) %>%
  summarise_at(.vars = vars("visitors"),
    .funs = list("visitors_per_year"=sum)) %>%
  mutate(year = as.numeric(year))
pv_grouped
```

–ì—Ä–∞—Ñ–∏—á–∫–∏, –≥–æ—Ä–Ω–∞—Ç–∞ —Ç–∞–±–µ–ª–∞ –º–æ–∂–µ –¥–∞ —ò–∞ –ø—Ä–∏–∫–∞–∂–µ–º–µ –Ω–∞ —Å–ª–µ–¥–Ω–∏–æ—Ç –Ω–∞—á–∏–Ω:

```{r national_parks_visitors_1}
 ggplot(data = pv_grouped) +
    aes(x = year) +
    aes(y = visitors_per_year / 10^6) +
    geom_line(color = "forestgreen") +
    geom_area(alpha = .3, fill = "forestgreen") +
    scale_y_continuous(labels = scales::unit_format(unit = "M")) +
    scale_x_continuous(breaks = seq(1910, 2016, 10),
      labels = c(1910, paste("'", seq(20, 90, 10), sep = ""), 2000, "'10")) +
    labs(x="") +
    labs(y="") +
    labs(title="U.S. national parks have never been so popular") +
    labs(subtitle="Annial recreational visits to national parks since 1904") +
    labs(caption="Source: National Parks Service") +
    ggthemes::theme_fivethirtyeight()
```

## –ù–∞—ò–¥–æ–±—Ä–∏—Ç–µ 10 –ø–∞—Ä–∫–æ–≤–∏

```{r group_the_data_3}
top10 <- park_visits %>%
  filter(year == "Total") %>%
  arrange(desc(visitors)) %>%
  top_n(n = 10, wt=visitors)

pv2 <- park_visits %>%
  filter(!year == "Total") %>%
  select(year, unit_name, visitors) %>%
  group_by(year) %>%
  mutate(year_rank = rank(-visitors)) %>%
  ungroup %>%
  mutate(year = as.numeric(year)) %>%
  arrange(year, year_rank)

pv2_top10 <- filter(.data = pv2, unit_name %in% top10$unit_name)

pv2_top10
```

–ò –≥—Ä–∞—Ñ–∏—á–∫–∏

```{r best_parks_1}
library(ggridges)
ord <- top10$unit_name[order(top10$visitors, decreasing = FALSE)]
lbl <- str_remove(ord, "National Park")

ggplot(data = pv2_top10) +
  aes(x = year) +
  aes(y = unit_name) +
  aes(fill = unit_name) +
  aes(group = unit_name) +
  aes(height = visitors) +
  aes(scale = .0000001) +
  ggridges::geom_ridgeline(alpha = .5) +
  theme_ridges() +
  labs(y = "") +
  labs(x = "") +
  labs(title = "National park visitors per year") +
  labs(subtitle = "The twenty most-visited parks overall") +
  # theme(axis.text.y = element_text(size = 14)) +
  scale_y_discrete(limits = ord, labels = lbl) +
  scale_fill_cyclical(limits = ord, values = c("dodgerblue", "forestgreen")) +
  scale_x_continuous(
    limits = c(1950, 2016),
    breaks = seq(1950, 2016, 10),
    labels = c("1950", "'60", "'70", "'80", "'90", "2000", "'10")
  ) +
  ggthemes::theme_fivethirtyeight()
```
